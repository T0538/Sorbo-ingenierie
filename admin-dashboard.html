<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Sorbo Ing√©nierie</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Styles sp√©cifiques pour le dashboard admin */
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .admin-header {
            background: linear-gradient(135deg, #d10000 0%, #b30000 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(209, 0, 0, 0.3);
        }

        .admin-header h1 {
            margin: 0;
            font-size: 2.5rem;
            text-align: center;
        }

        .admin-header p {
            text-align: center;
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .admin-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .admin-nav button {
            background: white;
            border: 2px solid #d10000;
            color: #d10000;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .admin-nav button:hover,
        .admin-nav button.active {
            background: #d10000;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(209, 0, 0, 0.3);
        }

        .admin-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #d10000;
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #d10000;
            font-size: 2rem;
        }

        .stat-card p {
            margin: 0;
            color: #6c757d;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #d10000;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: #d10000;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            background: #b30000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(209, 0, 0, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-buttons button {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #d10000;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .admin-nav {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1>üîê Dashboard Administrateur</h1>
            <p>Sorbo Ing√©nierie - Gestion du contenu</p>
        </div>

        <!-- Navigation -->
        <div class="admin-nav">
            <button class="nav-btn active" data-section="stats">üìä Statistiques</button>
            <button class="nav-btn" data-section="actualites">üì∞ Actualit√©s</button>
            <button class="nav-btn" data-section="logiciels">üíª Logiciels</button>
            <button class="nav-btn" data-section="emplois">üíº Emplois</button>
            <button class="nav-btn" data-section="formations">üéì Formations</button>
            <button class="nav-btn" data-section="contacts">üìû Contacts</button>
        </div>

        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Statistiques -->
        <div id="stats-section" class="admin-content">
            <h2>üìä Statistiques G√©n√©rales</h2>
            <div class="stats-grid" id="stats-grid">
                <div class="loading">Chargement des statistiques...</div>
            </div>
        </div>

        <!-- Actualit√©s -->
        <div id="actualites-section" class="admin-content hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üì∞ Gestion des Actualit√©s</h2>
                <button class="btn" onclick="openModal('actualite')">‚ûï Ajouter une actualit√©</button>
            </div>
            <div id="actualites-table">
                <div class="loading">Chargement des actualit√©s...</div>
            </div>
        </div>

        <!-- Logiciels -->
        <div id="logiciels-section" class="admin-content hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üíª Gestion des Logiciels</h2>
                <button class="btn" onclick="openModal('logiciel')">‚ûï Ajouter un logiciel</button>
            </div>
            <div id="logiciels-table">
                <div class="loading">Chargement des logiciels...</div>
            </div>
        </div>

        <!-- Emplois -->
        <div id="emplois-section" class="admin-content hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üíº Gestion des Emplois</h2>
                <button class="btn" onclick="openModal('emploi')">‚ûï Ajouter un emploi</button>
            </div>
            <div id="emplois-table">
                <div class="loading">Chargement des emplois...</div>
            </div>
        </div>

        <!-- Formations -->
        <div id="formations-section" class="admin-content hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üéì Gestion des Formations</h2>
                <button class="btn" onclick="openModal('formation')">‚ûï Ajouter une formation</button>
            </div>
            <div id="formations-table">
                <div class="loading">Chargement des formations...</div>
            </div>
        </div>

        <!-- Contacts -->
        <div id="contacts-section" class="admin-content hidden">
            <h2>üìû Gestion des Contacts</h2>
            <div id="contacts-table">
                <div class="loading">Chargement des contacts...</div>
            </div>
        </div>
    </div>

    <!-- Modal pour ajouter/modifier -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modal-title">Ajouter un √©l√©ment</h2>
            <form id="modal-form">
                <div id="modal-fields">
                    <!-- Les champs seront g√©n√©r√©s dynamiquement -->
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn">üíæ Sauvegarder</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">‚ùå Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:5000/api';
        const ADMIN_TOKEN = 'admin123';
        let currentSection = 'stats';
        let editingItem = null;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            setupNavigation();
        });

        // Navigation
        function setupNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const section = this.dataset.section;
                    showSection(section);
                    
                    // Mettre √† jour les boutons actifs
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        function showSection(section) {
            // Cacher toutes les sections
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Afficher la section demand√©e
            document.getElementById(section + '-section').classList.remove('hidden');
            currentSection = section;

            // Charger les donn√©es de la section
            switch(section) {
                case 'stats':
                    loadStats();
                    break;
                case 'actualites':
                    loadActualites();
                    break;
                case 'logiciels':
                    loadLogiciels();
                    break;
                case 'emplois':
                    loadEmplois();
                    break;
                case 'formations':
                    loadFormations();
                    break;
                case 'contacts':
                    loadContacts();
                    break;
            }
        }

        // Fonctions API
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${ADMIN_TOKEN}`
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'Erreur API');
                }

                return result;
            } catch (error) {
                console.error('Erreur API:', error);
                showAlert('Erreur: ' + error.message, 'error');
                throw error;
            }
        }

        // Statistiques
        async function loadStats() {
            try {
                const stats = await apiCall('/admin/stats');
                displayStats(stats.data);
            } catch (error) {
                document.getElementById('stats-grid').innerHTML = '<div class="alert alert-error">Erreur lors du chargement des statistiques</div>';
            }
        }

        function displayStats(stats) {
            const statsGrid = document.getElementById('stats-grid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>${stats.contacts}</h3>
                    <p>Contacts</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.formations}</h3>
                    <p>Formations</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.actualites}</h3>
                    <p>Actualit√©s</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.logiciels}</h3>
                    <p>Logiciels</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.emplois}</h3>
                    <p>Emplois</p>
                </div>
                <div class="stat-card">
                    <h3>${stats.actualitesPubliees}</h3>
                    <p>Actualit√©s Publi√©es</p>
                </div>
            `;
        }

        // Actualit√©s
        async function loadActualites() {
            try {
                const actualites = await apiCall('/admin/actualites');
                displayActualites(actualites.data);
            } catch (error) {
                document.getElementById('actualites-table').innerHTML = '<div class="alert alert-error">Erreur lors du chargement des actualit√©s</div>';
            }
        }

        function displayActualites(actualites) {
            const table = document.getElementById('actualites-table');
            if (actualites.length === 0) {
                table.innerHTML = '<div class="alert alert-error">Aucune actualit√© trouv√©e</div>';
                return;
            }

            table.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Titre</th>
                            <th>Cat√©gorie</th>
                            <th>Statut</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${actualites.map(actualite => `
                            <tr>
                                <td>${actualite.titre}</td>
                                <td>${actualite.categorie}</td>
                                <td><span style="color: ${actualite.statut === 'publie' ? 'green' : 'orange'}">${actualite.statut}</span></td>
                                <td>${new Date(actualite.datePublication).toLocaleDateString()}</td>
                                <td class="action-buttons">
                                    <button class="btn btn-secondary" onclick="editItem('actualite', '${actualite._id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-danger" onclick="deleteItem('actualite', '${actualite._id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Logiciels
        async function loadLogiciels() {
            try {
                const logiciels = await apiCall('/admin/logiciels');
                displayLogiciels(logiciels.data);
            } catch (error) {
                document.getElementById('logiciels-table').innerHTML = '<div class="alert alert-error">Erreur lors du chargement des logiciels</div>';
            }
        }

        function displayLogiciels(logiciels) {
            const table = document.getElementById('logiciels-table');
            if (logiciels.length === 0) {
                table.innerHTML = '<div class="alert alert-error">Aucun logiciel trouv√©</div>';
                return;
            }

            table.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Cat√©gorie</th>
                            <th>Prix</th>
                            <th>Disponible</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${logiciels.map(logiciel => `
                            <tr>
                                <td>${logiciel.nom}</td>
                                <td>${logiciel.categorie}</td>
                                <td>${logiciel.prix} FCFA</td>
                                <td><span style="color: ${logiciel.disponible ? 'green' : 'red'}">${logiciel.disponible ? 'Oui' : 'Non'}</span></td>
                                <td class="action-buttons">
                                    <button class="btn btn-secondary" onclick="editItem('logiciel', '${logiciel._id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-danger" onclick="deleteItem('logiciel', '${logiciel._id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Emplois
        async function loadEmplois() {
            try {
                const emplois = await apiCall('/admin/emplois');
                displayEmplois(emplois.data);
            } catch (error) {
                document.getElementById('emplois-table').innerHTML = '<div class="alert alert-error">Erreur lors du chargement des emplois</div>';
            }
        }

        function displayEmplois(emplois) {
            const table = document.getElementById('emplois-table');
            if (emplois.length === 0) {
                table.innerHTML = '<div class="alert alert-error">Aucun emploi trouv√©</div>';
                return;
            }

            table.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Titre</th>
                            <th>Entreprise</th>
                            <th>Lieu</th>
                            <th>Type</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${emplois.map(emploi => `
                            <tr>
                                <td>${emploi.titre}</td>
                                <td>${emploi.entreprise}</td>
                                <td>${emploi.lieu?.ville || 'N/A'}</td>
                                <td>${emploi.typeContrat}</td>
                                <td><span style="color: ${emploi.statut === 'actif' ? 'green' : 'red'}">${emploi.statut}</span></td>
                                <td class="action-buttons">
                                    <button class="btn btn-secondary" onclick="editItem('emploi', '${emploi._id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-danger" onclick="deleteItem('emploi', '${emploi._id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Formations
        async function loadFormations() {
            try {
                const formations = await apiCall('/admin/formations');
                displayFormations(formations.data);
            } catch (error) {
                document.getElementById('formations-table').innerHTML = '<div class="alert alert-error">Erreur lors du chargement des formations</div>';
            }
        }

        function displayFormations(formations) {
            const table = document.getElementById('formations-table');
            if (formations.length === 0) {
                table.innerHTML = '<div class="alert alert-error">Aucune formation trouv√©e</div>';
                return;
            }

            table.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Titre</th>
                            <th>Cat√©gorie</th>
                            <th>Prix</th>
                            <th>Dur√©e</th>
                            <th>Disponible</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${formations.map(formation => `
                            <tr>
                                <td>${formation.titre}</td>
                                <td>${formation.categorie}</td>
                                <td>${formation.prix} FCFA</td>
                                <td>${formation.duree}</td>
                                <td><span style="color: ${formation.disponible ? 'green' : 'red'}">${formation.disponible ? 'Oui' : 'Non'}</span></td>
                                <td class="action-buttons">
                                    <button class="btn btn-secondary" onclick="editItem('formation', '${formation._id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-danger" onclick="deleteItem('formation', '${formation._id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Contacts
        async function loadContacts() {
            try {
                const contacts = await apiCall('/admin/contacts');
                displayContacts(contacts.data);
            } catch (error) {
                document.getElementById('contacts-table').innerHTML = '<div class="alert alert-error">Erreur lors du chargement des contacts</div>';
            }
        }

        function displayContacts(contacts) {
            const table = document.getElementById('contacts-table');
            if (contacts.length === 0) {
                table.innerHTML = '<div class="alert alert-error">Aucun contact trouv√©</div>';
                return;
            }

            table.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>T√©l√©phone</th>
                            <th>Sujet</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${contacts.map(contact => `
                            <tr>
                                <td>${contact.name}</td>
                                <td>${contact.email}</td>
                                <td>${contact.phone || 'N/A'}</td>
                                <td>${contact.subject}</td>
                                <td>${new Date(contact.createdAt).toLocaleDateString()}</td>
                                <td class="action-buttons">
                                    <button class="btn btn-secondary" onclick="viewContact('${contact._id}')">üëÅÔ∏è</button>
                                    <button class="btn btn-danger" onclick="deleteItem('contact', '${contact._id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Modal
        function openModal(type, itemId = null) {
            editingItem = itemId;
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const fields = document.getElementById('modal-fields');

            // D√©finir le titre
            title.textContent = itemId ? `Modifier ${getTypeName(type)}` : `Ajouter ${getTypeName(type)}`;

            // G√©n√©rer les champs selon le type
            fields.innerHTML = generateFields(type, itemId);

            modal.style.display = 'block';

            // Si on modifie, charger les donn√©es
            if (itemId) {
                loadItemData(type, itemId);
            }
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            editingItem = null;
            document.getElementById('modal-form').reset();
        }

        function getTypeName(type) {
            const names = {
                'actualite': 'une actualit√©',
                'logiciel': 'un logiciel',
                'emploi': 'un emploi',
                'formation': 'une formation'
            };
            return names[type] || 'un √©l√©ment';
        }

        function generateFields(type, itemId) {
            const fields = {
                actualite: `
                    <div class="form-group">
                        <label for="titre">Titre *</label>
                        <input type="text" id="titre" name="titre" required>
                    </div>
                    <div class="form-group">
                        <label for="resume">R√©sum√© *</label>
                        <textarea id="resume" name="resume" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contenu">Contenu *</label>
                        <textarea id="contenu" name="contenu" rows="6" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categorie">Cat√©gorie</label>
                            <select id="categorie" name="categorie">
                                <option value="ingenierie">Ing√©nierie</option>
                                <option value="formation">Formation</option>
                                <option value="technologie">Technologie</option>
                                <option value="entreprise">Entreprise</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="statut">Statut</label>
                            <select id="statut" name="statut">
                                <option value="brouillon">Brouillon</option>
                                <option value="publie">Publi√©</option>
                                <option value="archive">Archiv√©</option>
                            </select>
                        </div>
                    </div>
                `,
                logiciel: `
                    <div class="form-group">
                        <label for="nom">Nom *</label>
                        <input type="text" id="nom" name="nom" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea id="description" name="description" rows="4" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categorie">Cat√©gorie</label>
                            <select id="categorie" name="categorie">
                                <option value="autocad">AutoCAD</option>
                                <option value="covadis">Covadis</option>
                                <option value="robot">Robot</option>
                                <option value="revit">Revit</option>
                                <option value="civil3d">Civil 3D</option>
                                <option value="sketchup">SketchUp</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prix">Prix (FCFA)</label>
                            <input type="number" id="prix" name="prix" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="disponible" name="disponible" checked>
                            Disponible
                        </label>
                    </div>
                `,
                emploi: `
                    <div class="form-group">
                        <label for="titre">Titre du poste *</label>
                        <input type="text" id="titre" name="titre" required>
                    </div>
                    <div class="form-group">
                        <label for="entreprise">Entreprise *</label>
                        <input type="text" id="entreprise" name="entreprise" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea id="description" name="description" rows="4" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="formation">Formation requise</label>
                            <input type="text" id="formation" name="formation">
                        </div>
                        <div class="form-group">
                            <label for="experience">Exp√©rience</label>
                            <input type="text" id="experience" name="experience">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ville">Ville</label>
                            <input type="text" id="ville" name="ville">
                        </div>
                        <div class="form-group">
                            <label for="typeContrat">Type de contrat</label>
                            <select id="typeContrat" name="typeContrat">
                                <option value="cdi">CDI</option>
                                <option value="cdd">CDD</option>
                                <option value="stage">Stage</option>
                                <option value="freelance">Freelance</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dateLimite">Date limite</label>
                        <input type="date" id="dateLimite" name="dateLimite">
                    </div>
                `,
                formation: `
                    <div class="form-group">
                        <label for="titre">Titre *</label>
                        <input type="text" id="titre" name="titre" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea id="description" name="description" rows="4" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categorie">Cat√©gorie</label>
                            <select id="categorie" name="categorie">
                                <option value="autocad">AutoCAD</option>
                                <option value="covadis">Covadis</option>
                                <option value="robot">Robot</option>
                                <option value="revit">Revit</option>
                                <option value="genie-civil">G√©nie Civil</option>
                                <option value="hydraulique">Hydraulique</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="niveau">Niveau</label>
                            <select id="niveau" name="niveau">
                                <option value="debutant">D√©butant</option>
                                <option value="intermediaire">Interm√©diaire</option>
                                <option value="avance">Avanc√©</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="prix">Prix (FCFA)</label>
                            <input type="number" id="prix" name="prix" min="0">
                        </div>
                        <div class="form-group">
                            <label for="duree">Dur√©e</label>
                            <input type="text" id="duree" name="duree" placeholder="ex: 5 jours">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="disponible" name="disponible" checked>
                            Disponible
                        </label>
                    </div>
                `
            };

            return fields[type] || '<p>Type non support√©</p>';
        }

        // Gestion du formulaire
        document.getElementById('modal-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (key === 'disponible') {
                    data[key] = value === 'on';
                } else if (key === 'dateLimite') {
                    data[key] = new Date(value);
                } else if (key === 'lieu' && key === 'ville') {
                    data.lieu = { ville: value };
                } else {
                    data[key] = value;
                }
            }

            try {
                if (editingItem) {
                    await apiCall(`/admin/${currentSection}/${editingItem}`, 'PUT', data);
                    showAlert(`${getTypeName(currentSection)} modifi√© avec succ√®s !`, 'success');
                } else {
                    await apiCall(`/admin/${currentSection}`, 'POST', data);
                    showAlert(`${getTypeName(currentSection)} ajout√© avec succ√®s !`, 'success');
                }
                
                closeModal();
                showSection(currentSection); // Recharger les donn√©es
            } catch (error) {
                showAlert('Erreur lors de la sauvegarde', 'error');
            }
        });

        // √âdition
        async function editItem(type, itemId) {
            openModal(type, itemId);
        }

        async function loadItemData(type, itemId) {
            try {
                const item = await apiCall(`/admin/${type}/${itemId}`);
                fillFormWithData(item.data);
            } catch (error) {
                showAlert('Erreur lors du chargement des donn√©es', 'error');
            }
        }

        function fillFormWithData(data) {
            Object.keys(data).forEach(key => {
                const field = document.getElementById(key);
                if (field) {
                    if (field.type === 'checkbox') {
                        field.checked = data[key];
                    } else {
                        field.value = data[key];
                    }
                }
            });
        }

        // Suppression
        async function deleteItem(type, itemId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet √©l√©ment ?')) {
                return;
            }

            try {
                await apiCall(`/admin/${type}/${itemId}`, 'DELETE');
                showAlert('√âl√©ment supprim√© avec succ√®s !', 'success');
                showSection(currentSection); // Recharger les donn√©es
            } catch (error) {
                showAlert('Erreur lors de la suppression', 'error');
            }
        }

        // Affichage des alertes
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Fermer le modal en cliquant √† l'ext√©rieur
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html> 